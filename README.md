# 5047
5047 CodeHub
用于储存5047 普适计算中所用到的代码
# 🗺️ 寻宝终端（Treasure Hunter Terminal）

基于 **ESP32** 的智能寻宝装置，通过 **语音唤醒 / 停止指令**、**BLE 信号强度** 与 **光线感应**，控制 RGB 灯带和蜂鸣器，实现互动式“找宝藏”体验。

---

## ⚙️ 功能概述
- 🎙️ **语音识别（Gemini API）**
  - 识别用户说话内容，判断是否进入/退出寻宝模式  
  - 识别：
    - “开始找宝藏” / “Wake up” → 进入扫描模式  
    - “停止搜索” / “Stop” → 返回待机模式  
  - 橙色指示灯：
    - 录音中 → **常亮**  
    - Gemini 分析中 → **慢速闪烁**

- 📡 **蓝牙信标（BLE）扫描**
  - 自动搜索目标设备名：`TREASURE_05`
  - 根据信号强度（RSSI）反馈 RGB 颜色和蜂鸣节奏：
    | 距离 | RSSI (dBm) | RGB 颜色 | 蜂鸣节奏 |
    |------|-------------|-----------|-----------|
    | 远 | ≤ −60 | 绿色 | 慢速 |
    | 中 | −60 ~ −50 | 蓝色 | 中速 |
    | 近 | ≥ −50 | 红色 | 快速 |
    | 找到 | ≥ −40 | 红灯闪烁 + 三轮蜂鸣 | 庆祝效果 |

- 💡 **光敏传感器 (LDR)**
  - 根据环境光亮度控制灯带开关：  
    - `LDR < 1600` → 开灯带  
    - `LDR > 1900` → 关灯带

---

## 🔧 可调参数
| 参数名 | 默认值 | 功能说明 |
|--------|---------|----------|
| `RMS_TRIGGER_THRESHOLD` | `1000` | 麦克风触发灵敏度阈值 |
| `LDR_ON_TH` / `LDR_OFF_TH` | `1600 / 1900` | 光线开关阈值 |
| `TH_SILENT` ~ `TH_FOUND` | `-70` → `-40` | BLE 信号强度分级 |
| `VOICE_COOLDOWN_MS` | `5000` | 麦克风触发冷却时间 |

> 可根据现场噪音、光线或距离环境微调以上数值。

---

## 🧩 硬件连接
| 模块 | 引脚定义 |
|------|-----------|
| I2S 麦克风（Fermion MEMS） | WS=14, SCK=16, SD=2 |
| RGB 灯（PWM） | R=21, G=22, B=23 |
| 光敏电阻（LDR） | A0 = 36 |
| 蜂鸣器 | 25 |
| LED 灯带 | 17 |
| 橙色状态灯 | 13 |

---

## 🚀 使用说明
1. 给 ESP32 上电（USB 或 3.3V）  
2. 设备自动连接 Wi-Fi 并进入待机模式  
3. 对麦克风说 **“开始找宝藏” / “Wake up”** → 进入扫描模式  
4. 靠近目标蓝牙信标 `TREASURE_05` → 灯光与蜂鸣器随距离变化  
5. 说 **“停止搜索” / “Stop”** → 返回待机状态  

---

## 🧠 提示
- 调整 `RMS_TRIGGER_THRESHOLD` 可适应不同噪音环境。  
- BLE 和语音逻辑互不干扰，可独立测试。  
- Wi-Fi 名称与 Gemini API Key 在代码中写死，仅供展示用。  
